=encoding utf-8

=head1 Имя

AProf - профайлер для периодически запускаемых процессов

=head1 Использование

 use AProf;
 
 use AProf logfile => '/path/to/logfile';
 
 use AProf logfile => '/path/to/logfile', 
            recursive => 1;
 
 use AProf logfile => 'STDOUT';
 
 use AProf logfile => 'NULL';
 
 my $report = AProf::full_log();

=head1 Описание работы

Данный модуль предназначен для снятия статистики с периодически
запускаемых perl-программ, для которых сложно организовать множество
B<тестовых> запусков.

Для использования данного профайлера достаточно включить в исследуемые
модули директиву:

 use AProf;

Модуль расчитает время выполнения каждой функции исследуемого модуля
и после завершения работы выдаст отчет в B<logfile>. Если B<logfile>
не установлен, то используется B<STDERR>.

В качестве B<logfile> могут использоваться следующие варианты:

=over

=item STDOUT или STDERR

Выдавать отчет в STDOUT или STDERR (последний вариант используется по 
умолчанию).

=item NULL

Не выдавать отчет никуда (аналогично B</dev/null>).

=item имя файла

Дописывать отчет в файл с указанным именем (основное применение).

=back

Можно записывать отчет самостоятельно (например если хочется хранить его
в базе данных, а не в файле). В этом случае установите в B<logfile> значение
B<'NULL'>, а отчет получайте при помощи вызова функции:

 my $report = AProf::full_log();

B<Примечание>: По умолчанию B<AProf> контроллирует время выполнения
функций входящих в тот модуль в который он подключен. Другие подключенные
модули не контроллируются. Другие профайлеры обычно позволяют
контроллировать и их. Для того чтобы заставить B<AProf> контроллировать
все подключенные модули, используйте опцию B<recursive =E<gt> 1> как показано
в примерах выше.

B<Примечание>: Помните, что при рекурсивном контроле перехват некоторых
функций затруднен или невозможен. Например имеются некоторые проблемы
при установке хуков на функции B<AUTOLOAD> итп. Список модулей и функций
исключенных из контроля Вы можете найти в начале файла L<AProf.pm> в массивах
B<SKIP_MODULES> и B<SKIP_FUNCTIONS>.

=head1 Формат профайла

При первой записи в файл (новый файл отчета), а так же при вызове функции
B<AProf::full_log> в самом начале выдается две строки заголовка, в котором
описано какие поля репорта что означают. Выдача информации идет в несколько
столбиков:

=over

=item Function

Имя функции, которая была под контролем профайлера.

=item calls

Количество вызовов функции за все время работы.

=item average

Среднее время требуемое на однократное выполнение функции.

=item max

Максимальное время за которое выполнилась данная функция.

=item min

Минимальное время за которое выполнилась данная функция.

=back

Перед записью очередной порции данных, в лог вставляется временная метка
вида 'B<** Profiled at 2008-12-10 12:32:37 **>', парсер логов может
использовать такие метки для постороения графиков времени выполнения
функции в зависимости от текущего времени, времени суток итп.

При записи отчета в лог не производится запись о функциях не вызванных
за время работы профайлера ни разу. Однако функция B<AProf::full_log>
включает в отчет все контроллируемые функции.

=head1 Парсинг логов.

Для парсинга логов и получения сводной информации от профайлера используйте
модуль L<AProf::EasyParser>. Например:

 perl -MAProf::EasyParser -e 'print aprof_report("filename.log")'

=head1 Копирайт

Copyright (С) Dmitry E. Oboukhov L<< mailto:<unera@debian.org> >>

=head1 Лицензия

Профайлер распространяется на условиях лицензии GPL версии 3 (или выше).
Подробности см в L<http://www.gnu.org/licenses/>.

=cut
